-- WHY: Базовая миграция для создания ENUM типов
-- Дата: 2025-01-08
-- Цель: Создать все необходимые ENUM типы перед основными миграциями

-- ============================================================================
-- СОЗДАНИЕ ENUM ТИПОВ
-- ============================================================================

-- 1. Статусы айсбергов
DO $$ 
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'iceberg_status') THEN
        CREATE TYPE iceberg_status AS ENUM (
            'ACTIVE',      -- Айсберг активен и пополняется
            'EXHAUSTED',   -- Полностью съеден
            'BREACHED',    -- Уровень пробит
            'CANCELLED'    -- Отменен трейдером (spoofing)
        );
    END IF;
END $$;

-- 2. Комментарии для документации
COMMENT ON TYPE iceberg_status IS 
'Статус айсберга в системе. ACTIVE = живой, EXHAUSTED = съеден, BREACHED = пробит, CANCELLED = спуфинг';

-- ============================================================================
-- ROLLBACK (если нужно удалить типы)
-- ============================================================================

/*
-- ОСТОРОЖНО: Удаление типа невозможно если он используется в таблицах!
-- Сначала нужно удалить все колонки типа iceberg_status

DROP TYPE IF EXISTS iceberg_status CASCADE;
*/
