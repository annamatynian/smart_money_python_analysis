# PRODUCTION CALIBRATION NOTES

## ‚ö†Ô∏è WEIGHTED OFI - –ê–ì–†–ï–°–°–ò–í–ù–û–°–¢–¨ –ó–ê–¢–£–•–ê–ù–ò–Ø

**–ò—Å—Ç–æ—á–Ω–∏–∫:** Gemini AI Validation (Weighted OFI Implementation Review)  
**–î–∞—Ç–∞:** 2025-12-29  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** HIGH (–≤–ª–∏—è–µ—Ç –Ω–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–π—Å–±–µ—Ä–≥–æ–≤)

---

## –ü–†–û–ë–õ–ï–ú–ê

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `calculate_ofi(use_weighted=True)` –≤ `domain.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –∑–∞—Ç—É—Ö–∞–Ω–∏—è:

```python
lambda_decay_scaled = lambda_decay * 100.0
weight = exp(-lambda_decay_scaled * distance_pct)
```

### –ß–∏—Å–ª–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä (BTC, Œª=0.1):

| Distance –æ—Ç mid | distance_pct | Exponent | Weight | –®—Ç—Ä–∞—Ñ |
|-----------------|--------------|----------|--------|-------|
| 0.1% (10 bps)   | 0.1          | -1.0     | 0.36   | 64%   |
| 0.5%            | 0.5          | -5.0     | 0.0067 | 99.3% |
| 1.0%            | 1.0          | -10.0    | 0.00005| 99.995%|

**–†–ò–°–ö:**
- –û—Ä–¥–µ—Ä –≤—Å–µ–≥–æ –≤ **0.1% –æ—Ç mid-price** (–±–ª–∏–∑–∫–æ –∫ —Å–ø—Ä–µ–¥—É!) –ø–æ–ª—É—á–∞–µ—Ç —à—Ç—Ä–∞—Ñ **64%**
- –î–ª—è BTC —Å —Ç–∏–ø–∏—á–Ω—ã–º —Å–ø—Ä–µ–¥–æ–º 0.01-0.05% —ç—Ç–æ –º–æ–∂–µ—Ç –æ—Ç—Å–µ–∫–∞—Ç—å **–†–ï–ê–õ–¨–ù–£–Æ** –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –º–∞—Ä–∫–µ—Ç-–º–µ–π–∫–µ—Ä–æ–≤
- OFI –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–Ω—É—Ç "—Ç–∏—Ö–∏–º–∏" - –Ω–µ –±—É–¥—É—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## –†–ï–®–ï–ù–ò–Ø (–≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ)

### ‚úÖ –í–ê–†–ò–ê–ù–¢ 1: –£–º–µ–Ω—å—à–∏—Ç—å Œª –≤ config.py (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–§–∞–π–ª:** `config.py`

```python
# BTC_CONFIG
lambda_decay: float = 0.01  # –ë—ã–ª–æ: 0.1 (10x –º—è–≥—á–µ)
```

**–≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ Œª=0.01:**
- Distance 0.1% ‚Üí weight = 0.90 (—à—Ç—Ä–∞—Ñ 10%) ‚úÖ
- Distance 0.5% ‚Üí weight = 0.61 (—à—Ç—Ä–∞—Ñ 39%)
- Distance 1.0% ‚Üí weight = 0.37 (—à—Ç—Ä–∞—Ñ 63%)

**–ü–ª—é—Å—ã:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –±–ª–∏–∑–∫–æ –∫ —Å–ø—Ä–µ–¥—É
- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ø—É—Ñ—ã –¥–∞–ª–µ–∫–æ –æ—Ç —Ü–µ–Ω—ã (>1%)

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ –∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

---

### ‚öôÔ∏è –í–ê–†–ò–ê–ù–¢ 2: –£–±—Ä–∞—Ç—å –º–Ω–æ–∂–∏—Ç–µ–ª—å √ó100

**–§–∞–π–ª:** `domain.py` (—Å—Ç—Ä–æ–∫–∞ ~1529)

```python
# –ë–´–õ–û:
lambda_decay_scaled = lambda_decay * 100.0

# –°–¢–ê–õ–û:
lambda_decay_scaled = lambda_decay  # –£–±—Ä–∞–ª–∏ √ó100
```

**–≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ Œª=0.1 –ë–ï–ó √ó100:**
- Distance 0.1% ‚Üí weight = 0.99 (—à—Ç—Ä–∞—Ñ 1%) ‚úÖ
- Distance 0.5% ‚Üí weight = 0.95 (—à—Ç—Ä–∞—Ñ 5%)
- Distance 1.0% ‚Üí weight = 0.90 (—à—Ç—Ä–∞—Ñ 10%)

**–ü–ª—é—Å—ã:**
- –û—á–µ–Ω—å –º—è–≥–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ (HFT)

**–ú–∏–Ω—É—Å—ã:**
- –ú–æ–∂–µ—Ç **–ù–ï** –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–ø—É—Ñ—ã –Ω–∞ 1-2% –æ—Ç mid
- –¢—Ä–µ–±—É–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å Œª (0.5-1.0) –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

### üî¨ –í–ê–†–ò–ê–ù–¢ 3: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ (Advanced)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ Œª –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–æ–Ω –≥–ª—É–±–∏–Ω—ã:

```python
if distance_pct < 0.2:  # –ë–ª–∏–∑–∫–æ –∫ —Å–ø—Ä–µ–¥—É
    lambda_scaled = lambda_decay * 10.0  # –ú—è–≥–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
else:  # –î–∞–ª–µ–∫–æ –æ—Ç —Å–ø—Ä–µ–¥–∞ (—Å–ø—É—Ñ—ã)
    lambda_scaled = lambda_decay * 100.0  # –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è
```

**–ü–ª—é—Å—ã:**
- –õ—É—á—à–µ–µ –∏–∑ –æ–±–æ–∏—Ö –º–∏—Ä–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å
- –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤

---

## –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ö–ê–õ–ò–ë–†–û–í–ö–ò

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Œª **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

### 1. **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å OFI**
```python
# –í –ª–æ–≥–∞—Ö TradingEngine
print(f"OFI (weighted): {ofi_weighted:.2f}")
```

**–•–æ—Ä–æ—à–æ:** OFI —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ (¬±1-10 BTC)  
**–ü–ª–æ—Ö–æ:** OFI –≤—Å–µ–≥–¥–∞ –±–ª–∏–∑–æ–∫ –∫ 0 (–º–µ—Ç—Ä–∏–∫–∞ "–º—ë—Ä—Ç–≤–∞—è")

### 2. **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ü–µ–Ω–æ–π**
```python
# –í analyze_iceberg_context()
correlation = np.corrcoef(ofi_history, price_changes)[0,1]
```

**–•–æ—Ä–æ—à–æ:** |correlation| > 0.3 (OFI –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ)  
**–ü–ª–æ—Ö–æ:** |correlation| < 0.1 (OFI –Ω–µ —Å–≤—è–∑–∞–Ω —Å —Ü–µ–Ω–æ–π)

### 3. **–î–µ—Ç–µ–∫—Ü–∏—è –∞–π—Å–±–µ—Ä–≥–æ–≤**
```python
# –í IcebergAnalyzer
print(f"Detected icebergs: {len(detected)} per hour")
```

**–•–æ—Ä–æ—à–æ:** 5-20 –∞–π—Å–±–µ—Ä–≥–æ–≤/—á–∞—Å (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è BTC)  
**–ü–ª–æ—Ö–æ:** 0-1 –∞–π—Å–±–µ—Ä–≥/—á–∞—Å (—Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)

---

## –ò–°–¢–û–†–ò–ß–ï–°–ö–ê–Ø –°–ü–†–ê–í–ö–ê

**2025-12-29:** –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `√ó100` –¥–ª—è "—Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–ø—É—Ñ–∏–Ω–≥–∞"  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –î–æ–∫—É–º–µ–Ω—Ç "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å–º–∞—Ä—Ç-–º–∞–Ω–∏ –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞" (—Ä–∞–∑–¥–µ–ª 3.2 OBI)

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–ª OBI (Order Book Imbalance), –∞ –Ω–µ OFI (Order Flow Imbalance)  
- OBI - —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Å–Ω–∏–º–æ–∫ —Å—Ç–∞–∫–∞–Ω–∞ (–Ω—É–∂–Ω–∞ –º—è–≥–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
- OFI - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∑–¥–µ—Å—å √ó100 –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∂—ë—Å—Ç–∫–æ)

**–í—ã–≤–æ–¥:** –§–æ—Ä–º—É–ª—ã OBI –∏ OFI –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å **—Ä–∞–∑–Ω—ã–µ** Œª!

---

## –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø –ü–û –¢–û–ö–ï–ù–ê–ú

| –¢–æ–∫–µ–Ω | Œª (OBI) | Œª (OFI) | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-------|---------|---------|-------------|
| BTC   | 0.10    | 0.01-0.02 | –£–∑–∫–∏–µ —Å–ø—Ä–µ–¥—ã, –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å |
| ETH   | 0.15    | 0.02-0.03 | –ß—É—Ç—å —à–∏—Ä–µ —Å–ø—Ä–µ–¥—ã |
| SOL   | 0.20    | 0.03-0.05 | –ë–æ–ª–µ–µ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω |

---

## TODO –ü–†–ò –î–ï–ü–õ–û–ï –í PRODUCTION

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç –Ω–∞ 7 –¥–Ω—è—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ofi_weighted` –≤ –ª–æ–≥–∞—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ¬±1-10 –¥–ª—è BTC)
- [ ] –ò–∑–º–µ—Ä–∏—Ç—å correlation(OFI, price_change) > 0.3
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è 5-20 –∞–π—Å–±–µ—Ä–≥–æ–≤/—á–∞—Å
- [ ] –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ "—Ç–∏—Ö–∏–µ" ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å Œª –¥–æ 0.01
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

---

## –ö–û–ù–¢–ê–ö–¢–´

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å Gemini AI –∏–ª–∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ—Å—Ç—ã –≤ `tests/test_weighted_ofi.py`

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-29
